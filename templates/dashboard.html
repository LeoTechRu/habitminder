<!-- /sd/habitminder/templates/dashboard.html -->
{% extends "base.html" %}
{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>–í–∞—à–∏ –ø—Ä–∏–≤—ã—á–∫–∏</h1>
        <a href="{{ url_for('create_habit') }}" class="btn btn-success">
            + –ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞
        </a>
    </div>

    <!-- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
    <div class="row g-4">
        {% for freq in ['daily', 'weekly', 'monthly'] %}
        <div class="col-12">
            <h3 class="text-{% if freq == 'daily' %}success{% elif freq == 'weekly' %}primary{% else %}warning{% endif %} mb-3">
                {% if freq == 'daily' %}üóì –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ
                {% elif freq == 'weekly' %}üìÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ
                {% else %}üìÜ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ{% endif %} –ø—Ä–∏–≤—ã—á–∫–∏
            </h3>
            
            <div class="row row-cols-1 row-cols-md-3 g-4">
                {% for habit in habits if habit.frequency == freq %}
                <div class="col">
                    <div class="card h-100 border-{% if freq == 'daily' %}success{% elif freq == 'weekly' %}primary{% else %}warning{% endif %} shadow-sm">
                        <div class="card-header bg-{% if freq == 'daily' %}success{% elif freq == 'weekly' %}primary{% else %}warning{% endif %} text-white">
                            <h5 class="card-title mb-0">{{ habit.title }}</h5>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="badge bg-dark">
                                    {{ habit.frequency|ru_frequency }}
                                </span>
                                <small class="text-muted">
                                    –°–æ–∑–¥–∞–Ω–æ: {{ habit.created_at.strftime('%d.%m.%Y') }}
                                </small>
                            </div>
                            
                            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
                            <div class="progress mb-3" style="height: 20px;">
                                <div class="progress-bar bg-success" 
                                     role="progressbar" 
                                     style="width: {{ (habit.progress.values()|sum / habit.progress.values()|length * 100) if habit.progress else 0 }}%"
                                     aria-valuenow="{{ habit.progress.values()|sum }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="{{ habit.progress.values()|length }}">
                                    {{ ((habit.progress.values()|sum / habit.progress.values()|length * 100)|round(1)) if habit.progress }}%
                                </div>
                            </div>
                            
                            <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ—Ç–º–µ—Ç–æ–∫ -->
                            <div class="habit-calendar" data-habit-id="{{ habit.id }}">
                                {% for date, status in generate_calendar(habit) %}
                                <div class="day 
                                    {% if status == 'completed' %}bg-success
                                    {% elif status == 'missed' %}bg-danger
                                    {% else %}bg-light{% endif %}" 
                                     data-date="{{ date }}"
                                     data-bs-toggle="tooltip" 
                                     title="{{ date|format_tooltip(habit) }}"
                                     {% if not is_future_date(date) %}style="opacity:0.6; pointer-events:none"{% endif %}>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="col-12">
                    <div class="alert alert-info">
                        –ù–µ—Ç {{ freq|ru_frequency }} –ø—Ä–∏–≤—ã—á–µ–∫
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}